---
title: "DS_almond_profit"
author: "Danielle Sclafani"
date: "4/18/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## trying almond profit
```{r}
library(purrr)
library(here)
library(tidyverse)
library(ggpubr)

```

### Trying over with varying the coefficients


```{r}
clim_data <- read.delim(here("data", "clim.txt"), sep = " ")

#sourcing in almond yield function
source(file = here("R", "almond_yield.R"))

almond_yield

nsamples =300

#creating samples of coefficient 1
coef_1 = rnorm(mean = -0.015, sd = 0.005, n =nsamples)

#creating samples of ceofficient 3
coef_3= rnorm(mean = 0.07, sd = 0.025, n=nsamples)

parms = cbind.data.frame(coef_1, coef_3)

results = parms %>% pmap(almond_yield, 
                         data = clim_data, 
                         coef_2 = 0.0046, 
                         coef_4 = 0.0043, 
                         const = 0.28)

results[[1]]
```

```{r}
length(results)
```


```{r}
#extracting the results from above, the output of the function is yield, so we extract the yield results as a list
a_yield = map_df(results,`[`,c("yield"))

#now we can add the yield results to the parameters of coef_1 and coef_3 that we varied
a_yield = cbind.data.frame(a_yield, parms)

#now plotting the graphs
yield_plot_1 = ggplot(data=a_yield, aes(coef_1, yield, col = coef_3)) +geom_point(cex=2)+
  labs(y="Almond Yield Anamoly (tons/acre)", x = "Variation in coeficient 1")

#yield_plot_1

yield_plot_2 = ggplot(data=a_yield, aes(coef_3, yield, col = coef_1)) +geom_point(cex=2)+
  labs(y="Almond Yield Anamoly (tons/acre)", x = "Variation in coeficient 3")

#yield_plot_2

#need to download library for ggarround before i can run this
ggarrange(yield_plot_1, yield_plot_2) 
```


```{r}
# tmp=map_df(results,`[`,c("year"))
# annual_yield = as.data.frame(tmp$yield)
# colnames(annual_year) = "year"
# annual_yield$yield = tmp$yield
```

#skipped the annual part on pmap page for now- not sure if we need it


```{r}
#right now we have 300 samples per year, we might need to results- groupby yield and summarize by mean?--> need to convert results ot a data frame- need to use pivot longer? not 

results_df <- as.data.frame(results)

mean_results <- results_df %>% group_by(years) %>% 
  summarise(mean_yield = mean(yield))


#For Loop section of Prof Notes 

mean_yield_for = rep(NA, times=nsamples)
#for annual we need rows
years= unique(clim_data$year)

annual_yield_for = as.data.frame(matrix(ncol = nsamples, nrow = (years)))

annual_yield_for$year = years
```

